class KifuViewer{constructor(e,t){this.board=e,this.canvas=document.createElement("canvas").getContext("2d"),this.canvas.font="22px YuMincho, Hiragino Mincho ProN, MS Mincho, serif",this.options=t||{},this.options.buttons||(this.options.buttons="default"),this.options.keybinds||(this.options.keybinds=this.board.parentNode),this.options.comment||(this.options.comment=null),this.options.start||(this.options.start=0),this.options.reverse||(this.options.reverse=!1),this.options.onMove||(this.options.onMove=()=>{})}defaultButtons(){return`
<div class='kifu-viewer-buttons mb-2' style='text-align:center;'>
<button class='kifu-viewer-first material-icons btn btn-lg btn-outline-secondary'>first_page</button>
<button class='kifu-viewer-prev material-icons btn btn-lg btn-outline-secondary'>chevron_left</button>
<button class='kifu-viewer-next material-icons btn btn-lg btn-outline-secondary'>chevron_right</button>
<button class='kifu-viewer-last material-icons btn btn-lg btn-outline-secondary'>last_page</button>
<button class='kifu-viewer-reverse material-icons btn btn-lg btn-outline-secondary'>autorenew</button>
</div>`}defaultKeybinds(e){switch(e.key){case"ArrowUp":this.first();break;case"ArrowDown":this.last();break;case"ArrowLeft":this.prev();break;case"ArrowRight":this.next();break}}loadKeybinds(){this.keybinds=e=>{this.defaultKeybinds(e)},this.options.keybinds.addEventListener("keydown",this.keybinds)}removeKeybinds(){this.options.keybinds.removeEventListener("keydown",this.keybinds)}loadButtons(){if(this.options.buttons=="none")return;this.options.buttons=="default"&&(this.board.insertAdjacentHTML("afterend",this.defaultButtons()),this.options.buttons=this.board.nextElementSibling),[...this.options.buttons.getElementsByClassName("kifu-viewer-first")].forEach(e=>{e.addEventListener("click",()=>{this.first()})}),[...this.options.buttons.getElementsByClassName("kifu-viewer-prev")].forEach(e=>{e.addEventListener("click",()=>{this.prev()})}),[...this.options.buttons.getElementsByClassName("kifu-viewer-next")].forEach(e=>{e.addEventListener("click",()=>{this.next()})}),[...this.options.buttons.getElementsByClassName("kifu-viewer-last")].forEach(e=>{e.addEventListener("click",()=>{this.last()})}),[...this.options.buttons.getElementsByClassName("kifu-viewer-reverse")].forEach(e=>{e.addEventListener("click",()=>{this.reverse()})})}get(e,t,n){const s=new XMLHttpRequest;s.open("GET",e),s.timeout=6e4,s.onloadend=()=>{n(s.responseText)},s.overrideMimeType("text/plain; charset="+t),s.send()}load(e,t,n=()=>{}){t=t||"UTF-8",this.get(e,t,e=>{this.data=KifuViewer.KIF解析(e),this.data.手数=KifuViewer.手数正規化(this.options.start,this.data.総手数),this.data.全局面=KifuViewer.全局面構築(this.data.全指し手,this.data.初期局面),this.局面描画(this.data.手数,this.data.手数),n(this.data)}),this.loadButtons(),this.loadKeybinds()}loadString(e,t=()=>{}){this.data=KifuViewer.KIF解析(e),this.data.手数=KifuViewer.手数正規化(this.options.start,this.data.総手数),this.data.全局面=KifuViewer.全局面構築(this.data.全指し手,this.data.初期局面),this.局面描画(this.data.手数,this.data.手数),this.loadButtons(),this.loadKeybinds(),t(this.data)}static 手数正規化(e,t){return!e||!t?0:(e<0&&(e=t+e+1),e>t?t:e)}static 全局面構築(e,t){const n=[];for(let s=0;s<e.length;s++){n[s]=[t];for(let t=1;t<e[s].length;t++)n[s].push(KifuViewer.全局面構築.各局面(e[s][t],n[s][t-1]))}return n}static KIF解析(e){const n={},t={局面図:[],解析:[]};e=e.split(/\r?\n/);for(let n=0;n<e.length;n++){if(e[n]=e[n].trim(),e[n].indexOf("#")===0)continue;if(e[n].indexOf("|")===0)t.局面図.push(e[n]);else if(e[n].indexOf("：")>-1){const s=e[n].split("：");t[s[0]]=s[1]}else if(e[n].indexOf("**Engines")===0)t.解析済み=!0;else if(e[n]==="後手番"||e[n]==="上手番")t.開始手番="後手";else if(e[n]==="先手番"||e[n]==="下手番")t.開始手番="先手";else if(e[n].match(/手数＝\d/))t.最終手=e[n];else if(e[n].match(/^[1*]/)){t.指し手=e.slice(n);break}}return n.先手名=t.先手||t.下手||"",n.後手名=t.後手||t.上手||"",n.開始手番=KifuViewer.KIF解析.開始手番(t.開始手番,t.手合割),n.最終手=KifuViewer.KIF解析.最終手(t.最終手),n.手合割=KifuViewer.KIF解析.手合割(t.手合割),n.評価値=t.解析済み?KifuViewer.KIF解析.評価値(t.指し手):[],n.読み筋=t.解析済み?KifuViewer.KIF解析.読み筋(t.指し手):["-"],n.初期局面={"駒":KifuViewer.KIF解析.局面図(t.局面図,n.手合割),"先手の持駒":KifuViewer.KIF解析.持駒(t.先手の持駒||t.下手の持駒),"後手の持駒":KifuViewer.KIF解析.持駒(t.後手の持駒||t.上手の持駒)},n.全指し手=KifuViewer.KIF解析.指し手(t.指し手,n.開始手番),n.総手数=n.全指し手[0].length-1,n.変化=0,n}static オブジェクトコピー(e){const t=Array.isArray(e)?[]:{};for(const n in e)t[n]=e[n]instanceof Object?KifuViewer.オブジェクトコピー(e[n]):e[n];return t}static 局面停止状態(e){return e.駒=="終"}static svg(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}static svgText(e,t,n,s,o){const i=KifuViewer.svg("text");return i.setAttribute("x",e),i.setAttribute("y",t),i.setAttribute("font-size",n),i.setAttribute("font-family","YuMincho, Hiragino Mincho ProN, MS Mincho, serif"),i.setAttribute("text-anchor",o),i.textContent=s,i}static svgLine(e,t,n,s){const o=KifuViewer.svg("line");return o.setAttribute("x1",e),o.setAttribute("x2",n),o.setAttribute("y1",t),o.setAttribute("y2",s),o.setAttribute("stroke","#000"),o.setAttribute("stroke-width",1),o}static svgRect(e,t,n,s){const o=KifuViewer.svg("rect");return o.setAttribute("x",e),o.setAttribute("y",t),o.setAttribute("width",n),o.setAttribute("height",s),o}指し手表示(e,t){let n;if(t.手数==0)n="開始局面";else{const e=t.手番==="▲"?"☗":"☖";n=t.手数+"手目  "+e+t.手}e?this.board.childNodes[1].textContent=n:this.board.appendChild(KifuViewer.svgText(15,530,17,n,"center"))}持駒計算(e){let t="";for(const n in e)e[n]!=0&&(t!=""&&(t+=" "),t+=n+e[n]);return t==""?"なし":t}持駒表示(e,t,n){const s=this.持駒計算(t.先手の持駒),o=this.持駒計算(t.後手の持駒),i=n?s:o,a=n?o:s;if(e)this.board.childNodes[2].firstChild.textContent=i,this.board.childNodes[3].firstChild.textContent=a;else{const e=KifuViewer.svgText(0,0,21,i,"left");e.setAttribute("transform","translate(15, 53)");const t=KifuViewer.svgText(0,0,21,a,"left");t.setAttribute("transform","translate(15, 500)"),this.board.appendChild(e),this.board.appendChild(t)}}局面描画(e,t){this.data.手数=t;const o=this.data.全局面[this.data.変化][t],n=this.data.全指し手[this.data.変化][t],i=this.data.全指し手[this.data.変化][e],s=this.options.reverse;this.board.childNodes.length>0?(this.指し手表示(!0,n),this.持駒表示(!0,o,s),this.駒配置(!0,o,s,n,i),this.評価値表示(!0,this.data.評価値[t],n)):(this.将棋盤描画(),this.指し手表示(!1,n),this.持駒表示(!1,o,s),this.指し手強調(!1,0,0),this.駒配置(!1,o,s,n,i),this.符号表示(!1,s),this.上下名称表示(!1,s),this.評価値表示(!1,this.data.評価値[t],n),this.showAttribution()),this.コメント表示(n.コメント)}コメント表示(e){this.options.comment&&(this.options.comment.innerHTML=e)}指し手初期化(){const e=this.board.childNodes[4];e.setAttribute("fill","none")}指し手強調(e,t,n){if(e){const e=this.board.childNodes[4];e.setAttribute("transform",`translate(${t}, ${n})`)}else{const e=KifuViewer.svgRect(t,n,40,40);e.setAttribute("fill","none"),this.board.appendChild(e)}}駒配置(e,t,n,s,o){let i;if(e?i=this.board.childNodes[5]:(i=KifuViewer.svg("g"),this.board.appendChild(i)),o&&Math.abs(s.手数-o.手数)==1){if(s.手数<o.手数){if(KifuViewer.局面停止状態(o))return;o.前X!=0&&this.駒描画(e,i,t.駒[o.前Y][o.前X],o.前X,o.前Y,!1,n),this.駒描画(e,i,t.駒[o.後Y][o.後X],o.後X,o.後Y,!1,n)}else{if(KifuViewer.局面停止状態(s))return;o.手数>=1&&this.駒描画(e,i,t.駒[o.後Y][o.後X],o.後X,o.後Y,!1,n)}s.手数==0?this.指し手初期化():(s.前X!=0&&this.駒描画(e,i,t.駒[s.前Y][s.前X],s.前X,s.前Y,!1,n),this.駒描画(e,i,t.駒[s.後Y][s.後X],s.後X,s.後Y,!0,n))}else if(this.data.最終手){const s=this.data.最終手[0],o=this.data.最終手[1];for(const a in t.駒)for(const r in t.駒[a]){let c=!1;r==s&&a==o&&(c=!0),this.駒描画(e,i,t.駒[a][r],r,a,c,n)}}else for(const o in t.駒)for(const a in t.駒[o]){let r=!1;a==s.後X&&o==s.後Y&&(r=!0),this.駒描画(e,i,t.駒[o][a],a,o,r,n)}}駒描画(e,t,n,s,o,i,a){s=10-s,n||(n=""),a&&(s=10-s,o=10-o,n=n.match("_")?n.replace("_",""):n+"_");let c=n;n.match("_")&&(c=n.replace("_",""));const l=40*s-40+32,d=40*o-40+94;if(i){const e=this.board.childNodes[4];e.setAttribute("fill","#111111"),this.指し手強調(!0,l-20,d-16)}let r;if(e){const e=a?80-9*o+s:9*o-s;r=t.childNodes[e],r.textContent=c}else r=KifuViewer.svgText(0,0,31,c,"middle"),r.setAttribute("dy",16),t.appendChild(r);n.match("_")?r.setAttribute("transform",`translate(${l}, ${d+8}) scale(-1, -1)`):r.setAttribute("transform",`translate(${l}, ${d})`),i?r.setAttribute("fill","#fff"):r.setAttribute("fill","#000")}盤外表示(){const e=KifuViewer.svgRect(0,58,395,390);return e.setAttribute("touch-action","manipulation"),e.setAttribute("fill","#FFE084"),e}盤枠表示(){const e=KifuViewer.svgRect(12,77,360,360);return e.setAttribute("fill","#FFE084"),e.setAttribute("stroke","#000"),e.setAttribute("stroke-width",2),e.setAttribute("id","ban"),e}showAttribution(){const e=KifuViewer.svg("a");e.setAttribute("href","https://marmooo.github.io/kifu-viewer/");const t=KifuViewer.svgText(300,500,17,"KifuViewer","left");t.setAttribute("text-decoration","underline"),e.appendChild(t),this.board.appendChild(e)}名称表示サイズ(e){const t=this.canvas.measureText(e).width,n=t<395?22:t/e.length;return n}上下名称表示(e,t){const o=this.data.先手名==""?"先手":this.data.先手名,i=this.data.後手名==""?"後手":this.data.後手名,n=t?"☗"+o:"☖"+i,s=t?"☖"+i:"☗"+o,a=this.名称表示サイズ(n),r=this.名称表示サイズ(s);if(e){const e=this.board.childNodes[7].childNodes;e[0].textContent=n,e[1].textContent=s,e[0].setAttribute("font-size",a),e[1].setAttribute("font-size",r)}else{const e=KifuViewer.svg("g");this.board.appendChild(e),e.appendChild(KifuViewer.svgText(10,23,a,n,"left")),e.appendChild(KifuViewer.svgText(10,470,r,s,"left"))}}評価値表示(e,t,n){let s="評価値  -";if(n!==void 0&&n!=="投了"&&t!==void 0){let e="";if(t.match("詰"))e="勝勢";else{const n=t.replace("-","");0<=n&&n<=300?e="互角":301<=n&&n<=800?e="有利":801<=n&&n<=1500?e="優勢":1501<=n?e="勝勢":e=""}let n;t.match("-")?n="☖後手":n="☗先手",e=="互角"&&(n=""),s="評価値  "+n+e+"("+t+")"}e?this.board.childNodes[8].textContent=s:this.board.appendChild(KifuViewer.svgText(215,530,17,s,"left"))}枡目表示(){const e=document.createDocumentFragment();for(let t=1;t<=8;t++)e.appendChild(KifuViewer.svgLine(12+40*t,77.5,12+40*t,360+77.5)),e.appendChild(KifuViewer.svgLine(12,77.5+40*t,370,77.5+40*t));return e}符号表示(e,t){let n=["１","２","３","４","５","６","７","８","９"],s=["一","二","三","四","五","六","七","八","九"];if(t&&(n=["９","８","７","６","５","４","３","２","１"],s=["九","八","七","六","五","四","三","二","一"]),e){const e=this.board.childNodes[6].childNodes;for(let t=0;t<=8;t+=1)e[t*2].textContent=n[t],e[t*2+1].textContent=s[t]}else{const e=KifuViewer.svg("g");this.board.appendChild(e);for(let t=0;t<=8;t++)e.appendChild(KifuViewer.svgText(355-40*t,73,14,n[t],"middle")),e.appendChild(KifuViewer.svgText(386,100+40*t,14,s[t],"middle"))}}将棋盤描画(){const e=KifuViewer.svg("g");this.board.appendChild(e),e.appendChild(this.盤外表示()),e.appendChild(this.盤枠表示()),e.appendChild(this.枡目表示())}first(){this.指し手初期化(),this.局面描画(this.data.手数,0),this.options.onMove(this.data)}prev(){this.data.手数>0&&(this.局面描画(this.data.手数,this.data.手数-1),this.options.onMove(this.data))}next(){const e=this.data.全指し手[this.data.変化].length-1;this.data.手数<e&&(this.局面描画(this.data.手数,this.data.手数+1),this.options.onMove(this.data))}last(){const e=this.data.全指し手[this.data.変化].length-1;this.局面描画(this.data.手数,e),this.options.onMove(this.data)}reverse(){this.options.reverse=!this.options.reverse,this.符号表示(!0,this.options.reverse),this.上下名称表示(!0,this.options.reverse),this.局面描画(this.data.手数,this.data.手数)}}KifuViewer.全局面構築.各局面=function(e,t){const n=KifuViewer.オブジェクトコピー(t);if(KifuViewer.局面停止状態(e))return n;const o=e.手番==="▲"?"先手":"後手",i={"歩":"と","香":"杏","桂":"圭","銀":"全","角":"馬","飛":"龍"},a={"と":"歩","杏":"香","圭":"桂","全":"銀","馬":"角","龍":"飛"};let s=e.駒;if(e.前X!==0){if(n.駒[e.前Y][e.前X]=null,e.成り&&(s=s in i?i[s]:s),n.駒[e.後Y][e.後X]){let t=n.駒[e.後Y][e.後X].replace("_","");t=t in a?a[t]:t,n[o+"の持駒"][t]++}}else n[o+"の持駒"][s]--;return o==="後手"&&(s+="_"),n.駒[e.後Y][e.後X]=s,n},KifuViewer.KIF解析.開始手番=function(e,t){return e?e:t&&t!=="平手"?"後手":"先手"},KifuViewer.KIF解析.最終手=function(e){if(!e)return;const t=e.match(/([１２３４５６７８９])(.)/);if(t){const e={"１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9"},n={"一":"1","二":"2","三":"3","四":"4","五":"5","六":"6","七":"7","八":"8","九":"9"};return e[t[1]]+n[t[2]]}},KifuViewer.KIF解析.手合割=function(e){const t=["香落ち","右香落ち","角落ち","飛車落ち","飛香落ち","二枚落ち","三枚落ち","四枚落ち","五枚落ち","左五枚落ち","六枚落ち","八枚落ち","十枚落ち","その他"];return t.indexOf(e)>=0?e:null},KifuViewer.KIF解析.局面図=function(e,t){if(e.length!==9)return t?KifuViewer.KIF解析.局面図.手合割(t):KifuViewer.KIF解析.局面図.平手();const o=KifuViewer.KIF解析.局面図.駒無し();let s=!0,n=10;const i={"王":"玉","竜":"龍"};for(let a=0;a<9;a++){n=10;const t=e[a];for(let e=1;e<t.length;e++){if(t[e]===" "){s=!0,n-=1;continue}if(t[e]==="v"){s=!1,n-=1;continue}if(t[e]==="|")break;if(t[e]==="・")continue;let r=t[e];r=r in i?i[r]:r,o[a+1][n]=s?r:r+"_"}}return o},KifuViewer.KIF解析.局面図.平手=function(){return{1:{9:"香_",8:"桂_",7:"銀_",6:"金_",5:"玉_",4:"金_",3:"銀_",2:"桂_",1:"香_"},2:{9:null,8:"飛_",7:null,6:null,5:null,4:null,3:null,2:"角_",1:null},3:{9:"歩_",8:"歩_",7:"歩_",6:"歩_",5:"歩_",4:"歩_",3:"歩_",2:"歩_",1:"歩_"},4:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},5:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},6:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},7:{9:"歩",8:"歩",7:"歩",6:"歩",5:"歩",4:"歩",3:"歩",2:"歩",1:"歩"},8:{9:null,8:"角",7:null,6:null,5:null,4:null,3:null,2:"飛",1:null},9:{9:"香",8:"桂",7:"銀",6:"金",5:"玉",4:"金",3:"銀",2:"桂",1:"香"}}},KifuViewer.KIF解析.局面図.駒無し=function(){return{1:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},2:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},3:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},4:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},5:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},6:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},7:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},8:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null},9:{9:null,8:null,7:null,6:null,5:null,4:null,3:null,2:null,1:null}}},KifuViewer.KIF解析.局面図.手合割=function(e){const t=KifuViewer.KIF解析.局面図.平手();switch(e){case"香落ち":return t[1][1]=null,t;case"右香落ち":return t[1][9]=null,t;case"角落ち":return t[2][2]=null,t;case"飛車落ち":return t[2][8]=null,t;case"飛車香落ち":return t[1][1]=null,t[2][8]=null,t;case"二枚落ち":return t[2][2]=null,t[2][8]=null,t;case"三枚落ち":return t[1][1]=null,t[2][2]=null,t[2][8]=null,t;case"四枚落ち":return t[1][1]=null,t[1][9]=null,t[2][2]=null,t[2][8]=null,t;case"五枚落ち":return t[1][1]=null,t[1][2]=null,t[1][9]=null,t[2][2]=null,t[2][8]=null,t;case"左五枚落ち":return t[1][1]=null,t[1][8]=null,t[1][9]=null,t[2][2]=null,t[2][8]=null,t;case"六枚落ち":return t[1][1]=null,t[1][2]=null,t[1][8]=null,t[1][9]=null,t[2][2]=null,t[2][8]=null,t;case"八枚落ち":return t[1][1]=null,t[1][2]=null,t[1][3]=null,t[1][7]=null,t[1][8]=null,t[1][9]=null,t[2][2]=null,t[2][8]=null,t;case"十枚落ち":return t[1][1]=null,t[1][2]=null,t[1][3]=null,t[1][4]=null,t[1][6]=null,t[1][7]=null,t[1][8]=null,t[1][9]=null,t[2][2]=null,t[2][8]=null,t;default:return t}},KifuViewer.KIF解析.持駒=function(e){const t={"歩":0,"香":0,"桂":0,"銀":0,"金":0,"飛":0,"角":0};if(e===void 0||e.match("なし"))return t;const s={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"十一":11,"十二":12,"十三":13,"十四":14,"十五":15,"十六":16,"十七":17,"十八":18},n=e.split(/\s/);for(let e=0;e<n.length;e++){const o=n[e][0],i=n[e][1];o in t&&(t[o]=i?s[i]:1)}return t},KifuViewer.KIF解析.指し手=function(e,t){const n=[[{手数:0,コメント:""}]];let s=0,o=0;if(n.変化手数=[],!e)return n;for(let i=0;i<e.length;i++)e[i]=e[i].trim(),e[i].indexOf("*")===0&&n[o][s]?n[o][s].コメント+=e[i].replace(/^\*/,"")+`
`:e[i].match(/^\d/)?(s++,KifuViewer.KIF解析.指し手.現在の手(n[o],e[i],s,t)):e[i].indexOf("変化：")===0&&(s=Number(e[i].match(/変化：(\d+)/)[1]),n.push(n[0].slice(0,s)),n.変化手数.push(s),s--,o++);return n},KifuViewer.KIF解析.指し手.手番解析=function(e,t){return e=="先手"?t%2==1?"▲":"△":t%2==1?"△":"▲"},KifuViewer.KIF解析.指し手.現在の手=function(e,t,n,s){const r={"１":1,"２":2,"３":3,"４":4,"５":5,"６":6,"７":7,"８":8,"９":9},c={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},l=["中断","投了","持将棋","千日手","詰み","切れ負け","反則勝ち","反則負け","入玉勝ち"],a=KifuViewer.KIF解析.指し手.手番解析(s,n),i=t.split(/ +/)[1]||"",o=i.match(/([１-９同])([一二三四五六七八九\u3000])([^(]+)(\((\d)(\d)\))?/);if(o)e.push({"手数":n,"手番":a,"手":o[0],"駒":o[3].replace(/[打成]$/,"").replace("成銀","全").replace("成桂","圭").replace("成香","杏").replace("王","玉").replace("竜","龍"),"前X":Number(o[5]||0),"前Y":Number(o[6]||0),"後X":o[1]==="同"?e[n-1].後X:r[o[1]],"後Y":o[1]==="同"?e[n-1].後Y:c[o[2]],"成り":/成$/.test(o[3]),"コメント":""});else if(0<=l.indexOf(i)){const t=e[e.length-1];e.push({"手数":n,"手番":a,"手":i,"駒":"終","前X":0,"前Y":0,"後X":t.後X,"後Y":t.後Y,"成り":!1,"コメント":""}),e.勝敗=KifuViewer.KIF解析.指し手.勝敗(i,a)}},KifuViewer.KIF解析.指し手.勝敗=function(e,t){const n={"勝者":"","敗者":"","理由":e,"表記":""};switch(e){case"投了":case"詰み":case"切れ負け":case"反則負け":n.勝者=t==="▲"?"△":"▲",n.敗者=t==="▲"?"▲":"△",n.表記=n.敗者+e+"で"+n.勝者+"の勝ち";break;case"反則勝ち":case"入玉勝ち":n.勝者=t==="▲"?"▲":"△",n.敗者=t==="▲"?"△":"▲",n.表記=n.勝者+e;break;case"時将棋":case"千日手":n.勝者=n.敗者="引き分け",n.表記=e+"で引き分け";break;case"中断":n.表記=e}return n},KifuViewer.KIF解析.評価値=function(e){const t=[];for(let n=0;n<e.length;n++){if(e[n].indexOf("**解析 0 ")!==0)continue;t.push(e[n].match(/評価値 (\S+)/)[1].replace(/↓|↑/,""))}return t},KifuViewer.KIF解析.読み筋=function(e){const t=["-"];for(let t=0;t<e.length;t++)if(e[t].indexOf("**解析 0 ")!==0)continue;return t}